clc
clear all
close all

[E4_ip, E4_fs] = audioread('trimed_E4_mono192kHz.wav');
% b = [125   123   121   122   121   123   124   128   130   135   138   143   152   161   171   176   180   187   190   192   194   193   187   184   179   174   173   171   172   178   184   192   204   215   229   245   261   270   288   303   319   336   355   371   390   410   431   453   475   499   525   554   582   613   642   670   699   725   750   777   805   831   859   887   914   939   967   988   1007   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1013   991   969   951   930   913   895   875   857   840   823   805   788   770   760   746   732   716   704   688   673   657   642   628   614   599   589   576   563   557   550   545   543   541   541   543   547   553   560   568   579   596   606   618   635   653   669   685   700   715   731   743   753   763   775   786   798   808   818   833   849   863   879   895   913   931   949   959   971   983   988   986   985   981   979   968   958   953   946   937   931   920   914   907   903   895   883   869   852   841   815   795   778   759   737   718   703   685   668   648   632   619   604   584   569   555   543   528   517   507   507   501   496   498   500   502   505   511   514   518   519   519   521   519   518   521   524   523   527   537   545   550   553   560   570   575   580   587   587   583   582   576   562   551   539   525   515   504   491   480   465   453   441   426   413   398   381   361   345   327   309   293   275   256   239   222   203   186   169   155   141   127   114   105   95   87   76   63   52   45   40   31   29   28   25   26   25   25   24   24   21   22   22   22   22   24   21   23   22   22   22   23   23   22   23   22   23   23   23   22   23   22   23   23   22   23   22   23   22   23   22   24   23   22   22   23   22   22   23   21   22   22   23   23   22   22   22   23   22   24   23   21   22   23   22   22   22   22   22   22   22   22   23   22   22   28   90   209   318   419   504   570   608   626   621   599   575   544   511   489   476   473   486   507   534   567   605   641   674   695   712   717   717   714   708   699   687   678   670   669   669   674   674   679   684   689   691   687   684   681   677     675   670   665   660   661   662   662   667   668   671   673   677   677   681   680   677   671   668   670   671   673   671   675   675   676   680   677   678   678   679   678   677   680   683   691   691   690   688   687   685   686   680   676   673   671   669   670   664   660   655   649   648   642   633   622   607   599   585   572   556   543   536   527   520   511   505   503   498   494   487   483   479   479   472   463   457   452   446   437   433   424   423   426   428   425   422   425   428   437   444   443   445   447   448   449   446   441   438   433   422   412   406   396   386   376   362   351   345   337   329   319   308   297   288   278   271   264   254   243   234   222   214   207   200   197   190   189   189   190   194   196   197   203   215   223   238   253   265   274   282   292   299   308   316   321   328   339   347   357   362   364   370   369   371   367   361   350   342   332   321   313   301   290   282   272   264   255   249   241   235   227   218   216   214   207   206   201   195   193   189   189   187   183   181   184   182   181   185   185   189   193   199   201   209   216   223   230   233   234   236   238   239   237   232   226   225   222   221   221   223   227   237   249   258   271   289   305   323   336   351   365   379   394   413   427   442   458   475   494   519   545   571   595   620   647   677   709   739   765   790   819   849   874   900   925   951   980   1005   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1018   969   922   882   847   819   797   782   772   767   767   764   761   755   749   739   723   709   693   675   652   630   613   597   587   577   568   567   568   572   577   585   593   602   611   622   634   642   655   667   680   693   705   714   726   738   752   764   779   794   809   827   841   856   872   887   903   917   927   940   953   963   971   977   982   985   986   985   981   983   980   977   974   970   969   965   951   940   927   914   899   886   867   855   845   830   814   802   786   770   756   734   713   694   676   655   636   617   595   579   564   551   540   532   528   525   523   526   527   531   533   535   536   538   539   536   535   538   534   537   539   544   547   559   565   575   588   597   601   610   614   615   619   618   609   608   605   596   590   582   574   567   561   549   535   523   509   493   475   462   445   426   411   395   377   359   345   329   316   303   287   272   262   250   236   222   212   196   183   168   156   142   130   123   115   102   95   89   79   72   65   61   54   52   52   49   44   44   42   38   33   30   29   29   26   27   26   25   25   23   23   22   23   21   22   22   22   22   23   23   22   22   22   23   22   22   24   23   22   24   23   22   22   23   22   22   22   23   23   23   21   22   22   22   22   23   23   22   24   22   23   22   22   23   25   39   139   237   327   407   468   513   534   548   544   537   519   502   491   485   488   503   526   555   589   623   660   694   719   741   758   770   774   777   775   771   767   766   762   765   770   771   776   780   780   783   789   788   787   790   789   789   787   783   781   779   772   771   767   765   766   766   764   763   762   767   770   771   766   767   768   767   760   756   756   757   757   753   756   759   759   758   761   761   763   764   762   761   763   763   762   765   766   767   766   764   766   765   760   759   754   752   751   742   736   732   724   715   709   703   694   685   674   663   655   647   635   631   626   620   615   611   605   599   595   589   579   571   563   553   547   542   538   533   531   528   526   523   523   523   521   521   521   522   527   528   529   530   532   531   529   526   522   522   517   511   506   497   488   476   465   453   442   430   420   411   400   390   381   371   358   348   338   324   315   304   292   286   280   274   272   264   262   267   271   275   282   287   298   311   326   333   343   355   369   381   393   400   410   417   424   433   439   445   448   451   451   452   449   443   443   438   429   419   410   401   391   382   373   361   353   339   336   318   312   306   300   298   296   297   291   285   282   276   268   259   247   245   238   235   237   237   242   244   255   260   267   276   283   291   292   293   297   300   299   299   299   295   294   293   291   290   289   290   293   294   300   306   316   324   337   351   361   373   386   396   409   419   432   449   464   482   504   523   543   566   591   614   639   662   685   709   738   761   785   811   839   870   902   935   968   998   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   991   939   888   843   807   780   764   755   757   756   756   759   758   756   748   737   725   712   698   683   671   657   650   645   644   647     654   667   681   692   708   721   735   748   763   770   781   793   801   816   823   835   849   865   877   895   913   934   953   970   985   996   1008   1019   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1016   1002   990   973   959   943   931   914   892   869   847   828   809   786   765   746   730   716   699   685   673   663   656   650   639   636   632   626   620   618   613   610   609   605   605   605   605   604   608   612   617   625   632   641   651   660   668   677   682   685   690   693   692     693   691   686   683   678   673   667   659   651   644   634   622   614   600   583   564   543   523   508   485   463   445   427   409   391   373   359   346   335   323   312   300   289   276   257   240   224   208   189   174   161   148   140   129   121   115   113   109   107   104   103   100   95   94   88   84   77   70   62   59   54   50   48   47   44   43   41   40   37   35   34   32   33   33   31   30   28   28   28   28   28   28   27   25   25   25   24   25   24   24   23   24   22   23   23   22   23   22   23   23   25   25   27   32   64   104   144   179   212   243   266   285   300   311   317   324   332   344   355   373   393   415   438   468   496   523   550   578   599   622   635   650   659   675   681   696   712   721   734   744   752   761   771   776   780   787   789   787   785   786   787   784   783   783   779   778   777   777   773   775   773   767   771   769   764   762   761   761   759   758   758   757   751   750   745   742   739   734   731   730   732   732   732   734   738   741   746   748   746   749   750   748   749   748   743   742   737   734   735   735   736   737   742   747   753   754   753   756   759   755   751   746   739   727   719   708   698   690   680   668   661   651   645   636   627   618   612   606   601   594   588   583   577   570   564   555   545   538   531   524   517   515   510   508   503   500   507   513   516   519   523   523   527   527   521   523   526   526   526   518   514   510   504   500   495   488   478   471   462   449   441   429   418   409   401   393   385   372   362   349   339   327   315   305   295   291   285   282   281   282   283   286   287   286   290   296   303   312   318   326   338   351   363   378   389   403   419   430   445   456   466   472   478   481   480   477   472   461   458   451   439   432   419   411   408   391   385   377   373   372   371   367   363   358   354   345   336   325   314   306   295   287   280   272   266   267   267   264   271   277   283   294   302   307   316   319   325   327   327   323   319   318   315   314   311   306   306   305   306   311   315   317   322   329   335   340   348   355   363   370   379   387   392   401   414   431   443   461   476   497   521   542   559   580   602   626   650   674   698   725   754   783   810   839   865   897   926   958   990   1020   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   993   937   885   837   798   767   744   731   724   719   717   717   713   707   701   693   679   663   648   634   622   612   606   603   606   614   622   631   644   657   672   685   702   713   730   744   754   767   777   786   794   800   812   822   835   848   860   879   894   912   929   947   966   982   995   1007   1017   1023   1023   1023   1023   1023   1023   1023   1023   1023   1020   1019   1018   1019   1022   1020   1014   1006   996   987   977   963   946   927   911   890   870   850   827   807   790   769   747   731   712   693   679   666   653   644   635   626   618   611   602   595   590   586   579   575   572   570   570   570   574   574   581   589   597   605   610   615   618   625   631   635   643   647   653   658   661   660   660   659   655   651   646   636   630   623   614   606   598   587   574   563   547   528   513   494     476   461   441   419   400   383   373   357   341   331   318   305   294   281   264   249   236   220   198   176   158   140   125   108   96   86   77   72   66   61   59   61   59   56   54   48   46   40   36   32   30   28   29   27   25   26   26   23   24   23   20   22   23   21   23   22   23   22   22   22   22   23   21   23   22   23   24   24   22   22   24   21   23   23   20   23   23   22   21   22   22   23   21   22   23   24   22   25   22   22   22   22   23   23   23   21   23   28   95   201   296   381   453   510   545   563   562   548   534   511   489   474   472   481   492   515   546   584   616   647   676   703   721   731   735   737   738   732   727   725   723   721   722   721   715   716   718   718   716   711   710   713   710   705   706   709   707   706   707   707   710   710   711   712   705   705   703   701   696   695   695   695   694   695   697   702   703   703   705   703   704   703   702   699   701   701   701   703   703   707   709   710   710   715   717   716   716   717   718   716   713   706   701   694   684   679   671   665   657   647   639   636   625   616   609   600   590   583   572   561   550   541   533   528   521   514   506   500   492   489   481   474   469   467   462   462   463   462   465   468   467   473   475   479   482   482   481   478   478   474   470   466   461   454   449   441   436   430   421   415   409   401   398   389   378   371   360   347   334   321   305   294   279   269   257   244   236   228   205   225   231   233   238   244   251   257   261   261   263   268   273   273   283   288   295   305   318   332   350   365   378   392   401   410   415   420   418   416   403   388   375   361   345   334   324   316   315   315   312   313   314   312   305   299   290   282   271   256   243   225   213   199   187   180   174   171   169   173   176   179   188   191   195   198   198   201   204   204   205   208   210   210   211   212   210   207   204   198   197   200   203   202   204   203   207   212   219   225   231   236   245   254   264   275   284   295   307   322   341   358   376   394   414   438   463   486   505   525   549   578   603   631   655   686   721   751   782   809   837   867   894   921   946   971   993   1015   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   980   937   900   873   846   824   811   802   793   786   783   773   765   754   734   716   697   675   654   633   613   598   585   575   566   562   561   563   567   572   582   590   598   608   617   627   635   641   649   654   661   670   680   692   707   722   738   754   774   794   813   831   851   869   889   905   919   933   941   948   959   964   969   975   983   989   995   997   999   1002   1001   1001   999   991   987   982   976   968   961   955   946   937   923   907   895   878   857   836   813   794   775   754   731   710   691   678   665   653   639   629   620   607   597   589   575   569   558   548   543   535   536   535   532   529   531   536   541   550   557   566   574   583   588   594   597   600   607   606   610   613   612   613   611   609   608   607   602   596   591   585   575   565   551   541   530   516   505   489   475   455   439   421   409   395   377   361   347   330   318   302   280   263   249   236   220   205   187   175   164   149   138   126   112   100   89   82   73   67   60   54   53   51   50   47   43   37   34   32   28   28   27   26   24   26   24   24   23   22   22   22   21   24   23   23   23   22   22   22   23   22   22   22   22   23   23   23   22   20   22   22   27   22   24   23   22   23   23   22   22   23   22   23   23   21   22   22   21   23   23   23   23   23   23   22   23   22   23   23   25   32   121   221   321   397   469   525   558   570   567   551   535   515   498   482   477   482   491   511     535   563   599   625   653   675   692   702   711   715   713   709   702   693   688   682   673   668   663   658   658   656   655   657   659   656   658   659   655   656   663   661   659   661   662   656   653   648   645   645   645   639   637   639   642   641   642   643   642   647   648   645   647   653   651   646   647   646   643   643   643   637   639   645   647   651   653   654   649   645   641   635   627   621   622   615   605   600   594   585   581   574   566   560   554   544   535   524   518   512   501   496   491   485   474   467   458   446   434   429   417   407   398   395   390   386   382   386   388   391   399   406   413   419   423   421   420   414   414   409   408   402   397   390   383   376   374   370   370   368   363   360   350   342   331   316   301   281   263   245   228   211   198   185   175   166   157   155   150   146   146   141   141   141   141   139   142   144   147   153   157   166   169   178   185   195   208   221   232   239   253   263   272   282   289   293   288   296   291   282   279   272   266   263   252   247   239   231   226   218   210   205   200   194   189   186   178   170   157   145   133   121   109   99   93   88   82   81   82   84   84   87   95   103   110   116   119   123   126   127   124   127   126   127   125   128   127   127   128   125   126   127   127   128   128   129   131   137   142   152   164   172   183   192   202   213   223   237   247   260   271   286   303   321   334   359   382   406   431   456   483   509   534   562   591   618   647   673   698   732   758   787   816   842   868   891   912   934   954   971   986   998   1011   1021   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1022   1005   988   970   953   933   914   897   880   861   845   827   811   799   785   769   755   739   722   705   685   663   644   626   607   592   575   557   546   537   533   531   533   535   541   545   547   552   553   556   559   563   569   577   582   589   597   610   619   632   647   664   682   699   714   733   751   771   787   802   814   821   842   853   865   875   887   895   907   914   920   924   927   931   935   938   941   945   941   941   941   934   927   922   913   897   883   867   855   837   817   797   776   758   737   719   702   685   667   650   634   620   607   591   576   562   549   537   525   511   502   491   479   471   465   463   457   454   451   451   451   458   461   467   478   486   494   503   515   526   534   539   544   549   549   549   547   547   545   541   537   530   523   513   502   493   483   475   466   457   446   436   423   412   400   387   373   357   342   325   307   291   270   252   234   214   198   182   163   146   132   115   97   85   69   55   41   32   29   29   27   27   26   25   23   23   22   22   22   22   23   23   21   23   24   21   22   23   21   22   22   21   23   22   22   23   23   22   23   22   22   22   23   22   22   23   22   23   22   22   23   22   22   23   23   20   23   23   21   22   22   20   23   22   21   23   21   22   22   22   22   22   22   22   22   21   22   22   23   22   23   23   23   28   21   19   22   23   21   22   22   22   25   65   193   311   415   504   570   609   624   623   600   569   537   502   473   457   449   453   469   492   520   551   579   605   627   644   658   659   657   647   637   625   613   600   590   583   578   580   581   584   591   596   604   607   607   609   607   603   596   588   582   577   575   570   570   570   571   575   578   575   577   581   582   584   585   583   581   578   577   576   577   577   582   585   589   596   602   603   608   612   614   613   612   609   609   602   592   584   578   569   559   550   543   541   533   527   524   518   511   506   497   488   478   470   459   453   443   436   426   417   408   396   388   382   376   374   370   370   366   367   369   370   370   369   373   373   374   375   376   377   380   379   375   375   374   372   365   360   355   349   344   341   336   331   319   314   300   291   278   263   250   238   224   212   201   191   186   179   169   157   146   134   128   121   115   111   109   105   106   110   113   116   124   130   140   150   160   173   190   203   220   234   246   256   265   272   277   279   280   280   277   273   267   260   252   256   254   252   253   254   254   253   250   246   243   237   229   219   211   194   180   169   157   145   130   118   111   107   103   103   109   112   118   126   132   141   149   153   152   155   157   155   153   150   151   153   152   150   149   151   149   146   143   144   147   145   145   147   152   160   164   168   176   185   193   203   209   217   229   237   247   261   276   292   308   321   340   359   378   398   421   444   472   495   522   548   577   607   636   665   695   723   751   776   800   828   851   876   901   922   945   969   989   1007   1021   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1019   993   973   951   933   917   899   884   870   858     843   831   816   801   781   762   740   719   695   671   649   631   610   594   580   565   553   540   532   526   524   520   521   521   521   524   527   530   533   538   539   546   550   555   560   567   575   587   600   617   629   645   659   674   693   713   730   749   769   786   801   816   827   839   847   850   857   863   869   880   883   887   894   898   903   910   911   910   909   908   905   898   889   878   868   857   846   834   816   796   780   760   742   725   706   688   675   660   645   630   610   593   578   563   547   532   517   507   498   490   480   472   466   461   455   455   453   454   453   457   464   467   467   476   480   486   490   495   503   508   514   523   530   536   539   542   545   544   547   544   542   538   534   530   521   509   502   492   478   465   449   437   424   412   398   383   370   359   344   332   320   303   290   274   255   239   219   202   185   169   148   132   115   100   87   75   61   53   44   39   38   33   32   31   29   29   28   27   26   25   25   24   23   22   22   23   21   22   22   23   21   25   22   22   23   23   22   22   22   22   22   23   22   22   21   22   21   22   21   23   22   22   22   22   23   23   22   22   23   21   22   23   23   22   23   21   22   21   23   21   21   22   22   22   23   22   21   22   23   21   22   22   21   22   22   21   22   22   23   28   119   238   349   447   529   584   616   623   614   591   562   531   505   486   474   472   483   501   528   557   588   618   644   664   674   679   679   674   670   662   650   640   633   627   618   612   610   612   615   619   623   624   625   630   634   629   627   626   622   619   616   607   602   600   597   596   591   592   594   597   604   606   606   609   615   617   613   613   611   607   609   609   607   610   616   622   629   631   636   640   645   646   650   646   645   643   637   626   619   613   605   604   599   593   592   588   588   587   583   574   570   565   557   545   537   524   515   502   490   481   473   464   459   453   446   445   445   442   439   438   438   443   441   441   439   441   441   442   443   441   442   444   439   435   435   434   434   434   426   424   422   413   402   392   383   372   356   342   326   313   298   286   276   260   253   242   231   226   220   211   201   193   183   173   165   156   155   150   152   153   156   156   159   168   176   190   199   212   226   241   258   278   293   305   318   327   335   338   340   340   338   336   334   331   332   327   324   324   321   320   317   313   310   304   289   281   269   257   248   235   221   214   204   196   189   182   180   181   182   184   183   188   190   195   196   194   194   195   195   195   194   190   195   194   194   191   196   199   202   202   200   199   199   199   197   194   187   190   192   194   195   199   205   213   220   223   232   240   249   261   271   281   290   303   319   333   349   363   380   401   420   443   467   493   522   552   581   611   639   668   695   724   755   785   813   838   865   889   911   935   957   977   995   1013   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1021   981   943   911   888   867   852   836   824   815   808   799   785   769   750   733   712   692   671   650   635   614   598   586   577   568   564   561   561   563   562   563   565   567   569   574   575   578   587   598   607   616   622   632   647   651   665   683   703   725   747   766   783   802   823   837   851   863   879   891   902   910   921   927   931   938   944   952   964   972   975   982   988   991   993   988   985   980   973   961   945   927   912   899   885   868   851   836   815   802   787   767   754   740   724   708   692   677   662   644   625   615   604   595   584   571   560   556   552   543   540   536   533   533   536   537   541   542   547   550   555   561   570   574   577   584   585   589   598   602   611   618   619   619   620   619   614   609   604   599   591   583   574   565   553   545   532   519   507   492   479   467   454   438   424   411   394   371   353   335   319   305   288   268   254   237   220   205   193   177   164   155   147   139   127   121   116   110   101   95   87   79   71   63   55   48   42   35   31   29   27   28   27   27   24   24   24   24   23   22   23   24   22   23   22   23   24   23   23   22   23   23   22   22   21   22   21   20   23   21   22   21   22   21   22   23   21   22   24   21   24   22   22   22   22   22   16   26   22   25   22   23   23   23   22   23   22   21   24   24   21   24   29   117   222   319   404   472   521   546   557   553   536   517   496   479   466   464   469   485   504   527   558   590   618   645   666   682   696   705   709   709   703   699   692   687   680   675   672   670   669   671   674   677   681   683   685   685   685   686   686   682   679   677   676   677   673   671   671   669   669   671   674   673   671   671   671   672   674   669   672   671   669   669   667   667   669   671   675   679   686   694   697   699   700   705   703   701   696   690   683   682   679   671   668   663   655   652   649   644   640   636   627   622   616   605   595   584   577   567   560   549   539   527   518   505   494   483   474   465   461   461   461   459   459   461   462   465   465   463   462   464   465   466   462   457   457   453   455   456   453   452   454   452   446   443   437   432   430   426   419   411   399   387   376   361   343   326   312   300   292   284   274   265   255   245   238   232   224   217   209   206   201   199   197   196   197   201   207   228   235   249   263   279   296   313   322   335   347   357   370   376   382   386   389   390   389   387   382   381   378   377   376   375   375   378   375   373   373   368   361   354   342   330   321   306   293   279   266   254   247   238   229   227   226   224   231   232   233   239   243   243   244   246   244   250   252   249   250   255   256   251   247   242   242   241   238   236   235   238   237   238   238   238   238   239   245   246   248   255   261   272   283   293   302   314   325   335   345   358   371   388   405   424   441   458   481   508   530   552   579   610   633   661   689   720   747   780   807   836   866   893   921   944   969   993   1015   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1014   965   917   872   831   800   775   753   739   731   728   729   728   725   720   713   705   697   687   674   665   654   642   635   629   624   625   628   632   640   647   657   673   675   690   705   720   732   749   760   775   793   808   826   844   864   883   901   912   929   941   956   971   985   999   1011   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1008   995   978   959   943   930   912   895   879   867   853   836   819   803   786   770   753   735   719   705   692   681   671   663   656   652   649   648   647   646   647   648   650   654   653   655   659   663   669   678   685   692   696   700   702   708   706   708   710   710   707   705   702   702   699   694   689   684   676   667   661   652   642   633   623   615   600   588   571   558   545   528   512   492   475   456   439   417   399   379   360   344   328   309   293   278   265   256   247   236   226   215   207   199   190   178   169   158   146   136   124   116   107   102   98   94   92   90   93   87   84   82   73   68   67   56   50   50   48   46   45   42   39   40   36   34   32   32   29   30   28   28   28   26   25   25   23   23   24   23   23   23   23   22   24   23   21   23   22   24   23   22   22   23   23   23   22   23   22   22   23   23   27   40   113   183   254   313   366   405   430   447   453   454   450   447   444   447   456   465   486   509   535   564   592   621   651   673   692   707   719   727   731   736   735   737   733   735   735   735   737   742   747   752   758   760   763   766   765   763   762   760   755   751   745   739   735   730   725   720   720   716   719   718   726   735   743   747   750   754   754   755   757   756   756   756   751   749   748   745   747   751   748   754   755   760   765   770   777   783   787   788   789   786   785   784   782   777   775   769   766   762   758   752   746   740   735   732   727   722   717   708   698   687   676   662   651   638   626   616   605   596   590   585   580   578   574   573   572   570   568   569   565   561   559   557   548   543   543   542   546   546   548   550   558   558   562   561   562   563   562   557   553   547   536   529   519   503   491   478   468   458   450   440   433   420   409   398   388   374   366   356   344   333   321   311   306   297   286   282   280   279   284   288   292   303   315   327   340   350   366   380   392   407   417   422   430   435   437   436   437   436   439   437   441   441   445   447   448   450   449   445   442   435   427   419   406   395   381   367   355   342   332   318   312   303   298   293   289   286   288   288   291   296   298   301   304   305   307   307   308   308   311   311   312   312   315   313   315   314   314   313   312   304   300   294   288   283   284   285   288   293   299   306   313   318   324   332   335   344   351   355   367   372   385   393   404   413   430   447   466   486   508   529   555   576   601   625   652   679   711   741   769   799   828   855   885   911   937   961   987   1009   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1015   962   910   859   817   784   762   745   735   734   733   732   735   738   739   737   732   723   715   706   695   684   671   663   656   654   655   659   669   679   695   714   731   748   764   777   786   797   813   827   835   849   864   876   891   905   917   925   941   953   958   973   990   1002   1017   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1015   1001   988   979   966   949   940   921   901   885   867   845   825   809   788   772   761   741   727   716   702   687   673   659   648   639   627   621   615   609   608   604   599   603   604   603   604   608   613   619   621   626   632   639   644   649   651   653   659   662   665   664   665   665   668   665   661   657   649   644   634   626   617   608   603   596   587   577   565   559   547   531   519   507   491   474   457   439   421   403   383   365   350   335   319   305   291   280   269   255   244   233   225   215   207   193   183   169   155   146   136   126   119   112   104   99   94   87   86   83   80   75   71   64   59   55   48   42   38   38   35   35   34   32   32   31   28   31   29   28   28   27   27   26   25   25   24   23   22   22   22   25   23   21   22   23   21   23   24   22   22   23   22   24   22   23   22   21   22   22   22   22   23   23   22   26   40   117   189   254   315   369   410   436   452   458   455   454   450   447   451   458   473   495   522   549   581   613   643   671   695   710   724   737   745   751   755   753   754   757   759   762   764   767   772   778   781   784   783   785   788   793   793   794   791   790   790   786   782   779   776   776   778   774   771   772   775   777   779   777   773   774   769   767   767   764   759   761   760   754   751   748   748   750   757   760   766   773   775   783   791   793   794   791   788   786   783   775   767   761   755   755   754   751   749   748   745   743   742   735   730   721   711   700   687   673   661   645   629   611   593   579   567   558   552   551   547   546   544   545   548   548   550   549   549   550   551   554   553   554   555   556   561   569   573   573   575   577   579   583   580   575   571   569   563   556   543   532   520   508   494   479   463   450   439   432   422   415   405   394   383   374   360   349   332   314   301   279   266   254   250   249   251   253   255   257   266   274   283   291   298   310   321   333   344   350   355   366   374   377   383   387   395   401   404   407   411   413   415   415   412   411   412   410   407   401   399   392   385   375   369   358   346   333   326   313   301   292   283   278   278   278   277   278   278   278   278   278   277   275   275   275   275   270   270   269   272   271   271   272   270   274   274   274   275   274   273   273   268   264   264   262   259   257   260   261   266   272   276   281   287   296   303   310   315   321   326   332   344   353   361   374   391   408   425   447   466   491   517   546   573   598   625   654   683   711   737   765   791   817   844   865   887   913   936   954   972   990   1012   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   985   935   891   855   820   793   773   759   753   749   747   745   745   741   732   722   712   697   678   664   649   643   626   617   613   615   619   621   627   635   643   646   655   666   676   685   698   707   719   731   739   751   769   778   794   809   823   840   852   865   879   892   908   921   929   935   947   957   965   974   981   989   995   998   1002   1010   1011   1011   1012   1009   1000   991   981   969   956   945   930   916   899   882   873   858   840   825   809   791   777   763   743   727   711   698   684   667   653   641   632   620   609   601   590   585   575   567   564   565   563   564   566   567   573   580   583   588   594   599   609   614   617   622   627   630   637   639   639   639   640   638   638   634   629   626   625   623   617   610   600   593   584   575   568   560   549   538   525   511   496   475   457   443   427   406   387   370   352   339   321   304   287   273   258   245   232   218   207   195   182   170   160   148   140   130   116   107   94   85   77   68   58   55   50   48   43   41   37   36   31   29   28   28   26   27   26   25   25   25   24   22   24   23   22   22   22   23   22   22   23   21   22   24   23   22   17   28   21   22   21   22   22   23   23   22   24   23   22   23   22   23   23   22   24   23   21   23   23   22   22   23   22   22   24   21   23   22   28   75   167   254   337   409   463   499   518   520   519   505   495   481   469   462   467   483   501   527   555   585   616   645   667   684   698   702   707   708   706   701   697   692   689   684   684   687   687   688   688   689   695   697   697   697   701   703   704   703   700   694   692   689   685   681   676   671   670   670   665   665   664   659   659   659   661   665   667   664   664   667   669   670   671   671   673   675   677   678   680   682   683   684   683   683   684   684   685   683   678   678   681   679   675   670   667   661   661   655   645   637   627   617   605   594   586   577   569   561   554   546   540   538   531   521   513   503   501   498   492   484   478   476   476   474   470   468   467   468   471   473   476   479   482   485   483   482   479   475   474   469   464   458   453   445   439   427   419   409   402   394   385   374   368   360   350   340   322   304   292   267   251   237   225   215   206   197   188   183   176   172   174   174   177   185   193   201   215   227   238   252   262   271   279   285   292   298   306   313   319   329   336   344   350   355   356   360   363   364   367   365   361   357   353   348   344   335   325   313   301   290   277   264   252   240   231   226   222   219   220   217   217   220   218   215   215   214   216   215   213   211   212   213   216   219   220   219   223   222   219   219   218   215   213   209   204   203   201   198   199   202   207   214   216   221   227   230   237   238   241   246   250   253   255   261   269   278   289   304   316   334   351   368   392   415   439   464   489   511   538   565   593   621   648   676   701   732   757   782   808   830   856   879   898   921   937   957   976   996   1016   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1016   973   928   888   855   828   805   786   768   760   752   747   741   733   725   711   696   680   661   643   627   616   607   597   589   581   579   573   567   564   565   566   571   570   575   588   601   615   626   636   650   667   682   693   705   717   729   745   757   764   778   791   804   820   831   842   855   873   884   895   907   917   930   941   940   948   951   954   955   958   957   955   952   948   937   931   927   913   901   891   876   861   847   828   808   796   785   765   745   730   714   696   682  663   647   634   621   603   591   578   565   553   545   538   527   518   515   507   499   494   497   499   498   504   511   517   527   535   539   547   554   564   565   566   569   571   565   565   570   572   570   569   571   567   561   560   556   551   546   540   537   529   520   513   505   493   482   468   453   435   416   395   377   358   341   323   307   290   278   264   252   240   231   218   207   195   180   166   153   140   122   107   90   75   60   48   38   33   29   29   28   26   27   26   26   24   24   21   24   23   21   22   23   21   23   23   22   24   23   20   23   22   22   23   21   21   22   23   23   23   23   22   23   22   22   22   22   22   23   23   22   22   23   22   24   22   22   22   22   21   22   23   22   23   22   23   23   23   22   21   23   22   24   22   22   22   23   21   25   23   21   23   24   22   24   31   139   255   357   447   520   568   596   603   589   564   537   506   479   461   447   447   458   478   502   528   554   581   604   621   633   641   642   635   626   617   607   599   593   589   583   584   583   586   590   596   599   601   603   605   607   609   605   601   598   593   587   582   579   574   571   570   566   565   564   568   573   581   585   591   599   603   608   611   614   615   620   616   614   611   611   609   607   605   601   600   601   602   604   603   603   604   605   603   600   594   586   582   572   561   550   535   524   516   505   495   486   479   472   467   463   456   453   446   442   438   433   426   420   413   408   402   397   393   390   393   393   397   402   408   415   421   423   424   422   418   418   412   404   396   394   388   381   376   368   362   356   350   342   332   321   308   300   287   274   264   253   242   230   213   204   193   183   171   161   152   144   141   140   142   143   148   152   159   172   183   191   200   211   219   231   239   245   250   258   262   269   275   278   286   294   303   309   318   325   326   330   328   324   318   313   301   287   275   265   253   245   240   234   227   221   217   213   203   196   193   188   186   182   180   177   177   177   174   169   164   164   161   160   159   160   157   156   150   147   142   139   131   127   123   119   119   115   115   114   113   113   115   121   122   123   125   122   125   126   123   123   125   130   134   138   138   146   155   163   173   183   198   215   235   254   276   299   324   348   371   396   423   447   475   503   528   557   586   615   639   665   689   711   737   759   783   802   820   840   866   882   900   922   944   964   987   1004   1019   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1021   1015   1007   999   987   979   965   949   931   911   893   874   851   827   806   782   761   736   710   689   669   650  629   613   594   586   575   566   558   550   540   533   526   517   507   499   488   475   467   462   460   460   460   465   471   480   492   509   522   537   552   567   582   594   609   624   637   645   662   672   686   701   717   731   747   763   778   794   809   824   840   852   861   871   879   889   895   900   900   899   899   898   894   892   886   883   879   868   859   847   834   822   808   793   784   772   756   740   723   705   689   673   658   644   628   616   605   593   577   569   558   549   537   524   516   507   498   491   488   487   487   489   491   496   502   507   512   517   525   529   532   534   536   539   543   539   540   542   543   545   543   543   544   543   540   539   535   532   529   523   518   513   505   494   483   471   457   443   427   413   400   385   367   349   333   316   298   281   263   249   229   215   203   186   172   155   145   135   124   113   101   91   80   68   61   50   40   32   29   27   26   26   24   22   23   22   22   23   21   25   22   22   23   22   22   22   22   22   22   22   22   24   23   22   28   19   22   23   22   22   22   22   21   23   21   22   22   23   22   23   22   22   23   24   21   23   22   21   23   22   23   22   23   21   23   23   21   23   23   22   22   23   22   22   21   22   22   22   22   22   23   22   22   23   22   26   63   183   298   403   487   553   595   611   609   593   567   536   508   483   468   463   468   486   509   535   564   594   619   643   662   673   676   674   667   662   651   639   632   623   617   616   615   617   622   629   635   638   643   645   648   650   646   641   633   629   626   619   611   607   607   605   604   605   606   610   615   618   624   628   631   637   639   637   637   635   633   631   630   626   626   627   626   631   632   634   636   636   633   633   633   630   628   623   617   615   609   601   593   584   572   565   552   538   530   521   511   502   495   486   482   475   471   465   459   448   443   439   432   427   423   418   417   415   413   412   414   417   423   426   427   429   430   431   431   429   423   418   414   411   405   401   396   393   388   382   369   367   354   351   344   337   325   313   300   286   271   255   237   220   201   190   177   158   143   134   129   128   129   129   133   136   146   150   158   162   170   175   180   189   194   197   205   212   219   227   232   238   248   257   264   272   278   283   287   291   291   295   291   286   279   271   262   255   245   235   226   215   203   195   185   178   169   162   155   148   143   141   140   138   134   132   133   130   130   130   132   131   134   133   134   134   135   139   137   136   135   134   132   133   132   129   126   125   122   122   119   116   116   117   118   121   123   125   129   135   141   147   153   157   164   167   171   180   188   194   206   219   231   249   267   286   308   329   354   381   413   441   475   508   540   574   602   629   658   685   708   734   751   767   786   804   824   843   862   881   902   924   945   967   985   1001   1018   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1023   1014   1003   989   972   951   932   918   897   877   854   829   806   781   771   746   729];
% E4_ip = b - 512;

SignalBuffer = E4_ip(1:7680);

SignalLength = 7680;
CrossCorrLength = SignalLength/2;
LagAmount = SignalLength/2;
% LagAmount = 3840;
Nominator = 0;

MiddleLag = 1;
ThinSecHighPeakValue = 0;
SecHighPeakValue = 0;

SamplingFrequency = 192000;
Period = 0;
PeriodHz = 0;

ThiningFactor = 20;
ThinLagAmount = LagAmount/ThiningFactor;
CorrIndex = 0;
for i= 1: 1: LagAmount
    
    if(mod(i,20) == 1)
        CorrIndex = CorrIndex+1;
        SamplesAmount = (SignalLength - i);
    	Nominator = 0;
        StarterSample = SignalLength - SamplesAmount;
        
        for j = 1:1:SamplesAmount

            Nominator = Nominator + (SignalBuffer(StarterSample + j) * SignalBuffer(j));

            if(Nominator < 0)
                Nominator = 0;
            end
        end
        CrossCorrBuffer(CorrIndex) = Nominator;
    end
end


% xlim([-5 inf])
% ylim([-5 80])

% Calculating the length of middle corr peak
	for(LagCounter = MiddleLag: 1: ThinLagAmount)
	
		if(CrossCorrBuffer(LagCounter) == 0)
		
			ThinMiddlePeakHalfLength = (LagCounter - 1);
			break;
        else
            CrossCorrBuffer(LagCounter)= 0;
        end
    end


%Finding second highest peak in corr
for(LagCounter = 1: 1: ThinLagAmount)

    if(CrossCorrBuffer(LagCounter) > ThinSecHighPeakValue)

        ThinSecHighPeakValue = CrossCorrBuffer(LagCounter);
        ThinSecHighPeakPos = LagCounter;
    end
end

% plot(CrossCorrBuffer)
ThinSecHighPeakPos = ThinSecHighPeakPos - 1;
AimedPeakPos = ((ThinSecHighPeakPos * ThiningFactor) + 1);
AimedCorrIndex = 0;
for i = (AimedPeakPos - ThiningFactor): 1: (AimedPeakPos + ThiningFactor)
    AimedCorrIndex = AimedCorrIndex + 1;
    SamplesAmount = (SignalLength - i);
    Nominator = 0;
    StarterSample = SignalLength - SamplesAmount;
    
    for j = 1:1:SamplesAmount
        
        Nominator = Nominator + (SignalBuffer(StarterSample + j) * SignalBuffer(j));
        
        if(Nominator < 0)
            Nominator = 0;
        end
    end
        AimedCrossCorrBuffer(AimedCorrIndex) = Nominator;
end

plot(AimedCrossCorrBuffer)



for(LagCounter = 1: 1: ((ThiningFactor*2) +1))

    if(AimedCrossCorrBuffer(LagCounter) > SecHighPeakValue)

        SecHighPeakValue = CrossCorrBuffer(LagCounter);
        SecHighPeakPos = (AimedPeakPos - ThiningFactor) + LagCounter;
    end
end

	Period = SecHighPeakPos;

	PeriodHz = SamplingFrequency / Period